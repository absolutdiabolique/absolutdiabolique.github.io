<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<title>diabolical text</title>

<!-- JSZip -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<!-- MathJax -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
html, body { 
  margin:0; padding:0;
  width:100%; height:100%;
  background:#0b1220;
  color:#e6eef8;
  font-family:'IBM Plex Mono', monospace;
  overflow:hidden;
  perspective:1000px;
}

.ui {
  width:90%;
  margin:5% auto 0;
  background:#173063;
  border:1px solid black;
  border-radius:12px;
  display:flex;
  gap:10px;
  padding:8px 16px;
  flex-wrap:wrap;
  font-size:14px;
}

select, button {
  background:#0b1220;
  color:#e6eef8;
  border:1px solid #000;
  border-radius:6px;
  padding:4px 8px;
  cursor:pointer;
}

#expandPanel {
  width:100%;
  margin-top:8px;
  background:#112246;
  border-radius:8px;
  padding:10px;
  display:none;
}

.ta-container {
  margin:20px auto 0;
  position: fixed;
  top: 10%;
  left: 5%;
  width:90%;
  height:80%;
  transform-style:preserve-3d;
  cursor:grab;
  transition: 0.6s;
}

.ta-wrap {
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
}

.ta-front,.ta-back {
  position:absolute;
  inset:0;
  border-radius:12px;
  border:1px solid black;
  backface-visibility:hidden;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

.ta-front { background:#173063; }
.ta-back  { background:#fff; color:#0b1220; transform:rotateY(180deg); }

.editor {
  flex:1;
  background:transparent;
  border:none;
  resize:none;
  padding:20px;
  font-size:16px;
  font-family:inherit;
  color:inherit;
  box-sizing:border-box;
}

.preview {
  flex:1;
  padding:20px;
  overflow:auto;
  display:none;
  background:#0b1220;
  color:#e6eef8;
}
.ta-back .preview {
  background:#f0f0f0;
  color:#000;
}
</style>
</head>
<body>

<div class="ui">
  <select id="fontSelect">
    <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
    <option value="Times New Roman">Times New Roman</option>
    <option value="Arial">Arial</option>
  </select>

  <button id="decrease">A-</button>
  <button id="increase">A+</button>
  <button id="flip">Flip</button>
  <button id="reset">Reset</button>
  <button id="save">Save</button>

  <button id="expandToggle">More ▼</button>

  <div id="expandPanel">
    <button id="hashBtn">SHA-256</button>
    <hr>
    <button id="dlFront">Download front.txt</button>
    <button id="dlBack">Download back.txt</button>
    <button id="dlZip">Download both (zip)</button>
    <hr>
    <button id="toggleMath">MathJax Preview</button>
  </div>
</div>

<div class="ta-container" id="taContainer">
  <div class="ta-wrap">

    <div class="ta-front">
      <textarea id="editorFront" class="editor"></textarea>
      <div id="previewFront" class="preview"></div>
    </div>

    <div class="ta-back">
      <textarea id="editorBack" class="editor"></textarea>
      <div id="previewBack" class="preview"></div>
    </div>

  </div>
</div>

<script>
const ef = editorFront, eb = editorBack;
const pf = previewFront, pb = previewBack;
let rotX=0, rotY=0, flipped=false;
let mathOn=false;

fontSelect.onchange = e =>
  [ef,eb].forEach(x=>x.style.fontFamily=e.target.value);

increase.onclick = () =>
  [ef,eb].forEach(x=>x.style.fontSize =
    parseInt(getComputedStyle(x).fontSize)+2+"px");

decrease.onclick = () =>
  [ef,eb].forEach(x=>x.style.fontSize =
    Math.max(6,parseInt(getComputedStyle(x).fontSize)-2)+"px");

flip.onclick = () => {
  flipped=!flipped;
  taContainer.style.transform =
    `rotateX(${rotX}deg) rotateY(${rotY+(flipped?180:0)}deg)`;
};

reset.onclick = () => {
  rotX=rotY=0; flipped=false;
  taContainer.style.transform="rotateX(0) rotateY(0)";
};

save.onclick = () => {
  localStorage.setItem("df",ef.value);
  localStorage.setItem("db",eb.value);
};

toggleMath.onclick = () => {
  mathOn=!mathOn;
  [pf,pb].forEach(p=>p.style.display=mathOn?"block":"none");
  [ef,eb].forEach(e=>e.style.flex=mathOn?"1":"1");
  updateMath();
};

function updateMath(){
  if(!mathOn) return;
  pf.textContent=ef.value;
  pb.textContent=eb.value;
  MathJax.typesetPromise([pf,pb]);
}
ef.oninput=eb.oninput=updateMath;

let drag=false, px=0, py=0;
taContainer.onmousedown=e=>{drag=true;px=e.clientX;py=e.clientY};
onmouseup=()=>drag=false;
onmousemove=e=>{
  if(!drag)return;
  rotY+=(e.clientX-px)*0.5;
  rotX-=(e.clientY-py)*0.5;
  taContainer.style.transform =
    `rotateX(${rotX}deg) rotateY(${rotY+(flipped?180:0)}deg)`;
  px=e.clientX; py=e.clientY;
};

expandToggle.onclick = () => {
  const o = expandPanel.style.display==="block";
  expandPanel.style.display=o?"none":"block";
  expandToggle.textContent=o?"More ▼":"More ▲";
};

function dl(name,text){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([text]));
  a.download=name; a.click(); URL.revokeObjectURL(a.href);
}
dlFront.onclick=()=>dl("front.txt",ef.value);
dlBack.onclick =()=>dl("back.txt", eb.value);
dlZip.onclick  =async()=>{
  const z=new JSZip();
  z.file("front.txt",ef.value);
  z.file("back.txt", eb.value);
  const b=await z.generateAsync({type:"blob"});
  dl("texts.zip",b);
};

window.onload=()=>{
  ef.value=localStorage.getItem("df")||"";
  eb.value=localStorage.getItem("db")||"";
};
</script>
</body>
</html>
