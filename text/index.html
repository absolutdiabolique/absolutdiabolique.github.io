<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<title>diabolical text</title>
<style>
  html, body { 
    display: grid;
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #0b1220;
    color: #e6eef8;
    font-family: 'IBM Plex Mono', monospace;
    overflow: hidden;
    perspective: 1000px;
  }

  /* UI BAR + expandable area push layout down */
  .ui {
    position: relative;
    width: 90%;
    margin: 5% auto 0 auto;
    background: #173063;
    border: 1px solid black;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    box-sizing: border-box;
    font-size: 14px;
    flex-wrap: wrap;
    z-index: 5;
  }

  select, button {
    background: #0b1220;
    color: #e6eef8;
    border: 1px solid #000;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
  }

  /* Expandable area */
  #expandPanel {
    width: 100%;
    margin-top: 8px;
    background: #112246;
    border-radius: 8px;
    padding: 10px;
    display: none;
  }

  .expand-btn {
    background: #112246;
  }

  /* Flash animation */
  .flash {
    animation: flashAnim 0.125s alternate 4;
  }

  @keyframes flashAnim {
    0% { background: #0b1220; color: #e6eef8; }
    100% { background: #66ccff; color: #000; }
  }

  /* Textarea container */
  .ta-container {
    margin: 20px auto 0 auto;
    width: 90%;
    height: 80vh;
    transform-style: preserve-3d;
    transform-origin: center center;
    cursor: grab;
    transition: transform 0.6s;
  }

  .ta-container:active {
    cursor: grabbing;
  }

  .ta-wrap {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    transform-style: preserve-3d;
  }

  .ta-front, .ta-back {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    backface-visibility: hidden;
    overflow: hidden;
    transform-style: preserve-3d;
  }

  .ta-front {
    background: #173063;
    color: #e6eef8;
    border: 1px solid black;
  }

  .ta-back {
    background: #ffffff;
    color: #0b1220;
    border: 1px solid black;
    transform: rotateY(180deg);
  }

  textarea {
    width: 100%;
    height: 100%;
    background: transparent;
    color: inherit;
    border: none;
    resize: none;
    padding: 20px;
    box-sizing: border-box;
    font-size: 16px;
    font-family: inherit;
  }
</style>
</head>
<body>

  <div class="ui">
    <select id="fontSelect">
      <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Arial">Arial</option>
      <option value="Georgia">Georgia</option>
      <option value="'Courier New'">Courier New</option>
    </select>

    <button id="decrease">A-</button>
    <button id="increase">A+</button>
    <button id="flip">Flip</button>
    <button id="reset">Reset</button>
    <button id="save">Save</button>

    <button id="expandToggle" class="expand-btn">More ▼</button>

    <!-- Expandable panel -->
    <div id="expandPanel">
      <button id="hashBtn">SHA-256</button>
    </div>
  </div>

  <div class="ta-container" id="taContainer">
    <div class="ta-wrap" id="taWrap">

      <div class="ta-front">
        <textarea id="editorFront" placeholder="Front side..."></textarea>
      </div>

      <div class="ta-back">
        <textarea id="editorBack" placeholder="Back side..."></textarea>
      </div>

    </div>
  </div>

<script>
  const editorFront = document.getElementById('editorFront');
  const editorBack  = document.getElementById('editorBack');
  const fontSelect  = document.getElementById('fontSelect');
  const inc         = document.getElementById('increase');
  const dec         = document.getElementById('decrease');
  const flipBtn     = document.getElementById('flip');
  const resetBtn    = document.getElementById('reset');
  const container   = document.getElementById('taContainer');
  const save        = document.getElementById('save');

  let rotX = 0, rotY = 0, flipped = false;

  /* Font change */
  fontSelect.addEventListener('change', () => {
    editorFront.style.fontFamily = fontSelect.value;
    editorBack.style.fontFamily  = fontSelect.value;
  });

  /* Font size controls */
  inc.addEventListener('click', () => {
    [editorFront, editorBack].forEach(el => {
      const size = parseInt(window.getComputedStyle(el).fontSize, 10);
      el.style.fontSize = (size + 2) + 'px';
    });
  });

  dec.addEventListener('click', () => {
    [editorFront, editorBack].forEach(el => {
      const size = parseInt(window.getComputedStyle(el).fontSize, 10);
      el.style.fontSize = Math.max(size - 2, 6) + 'px';
    });
  });

  /* Flip card */
  flipBtn.addEventListener('click', () => {
    flipped = !flipped;
    container.style.transform =
      `rotateX(${rotX}deg) rotateY(${rotY + (flipped ? 180 : 0)}deg)`;
  });

  /* Reset orientation */
  resetBtn.addEventListener('click', () => {
    rotX = 0;
    rotY = 0;
    flipped = false;
    container.style.transition = "transform 0.5s";
    container.style.transform = `rotateX(0deg) rotateY(0deg) rotate(0deg)`;
    setTimeout(() => container.style.transition = "", 600);
  });

  save.addEventListener('click', () => {
    const frontText = editorFront.value;
    const backText  = editorBack.value;
  
    const totalLength = frontText.length + backText.length;

    localStorage.setItem(STORAGE_KEY_FRONT, frontText);
    localStorage.setItem(STORAGE_KEY_BACK,  backText);
  });


  /* Drag rotation */
  let isDragging = false, prevX = 0, prevY = 0;

  container.addEventListener('mousedown', (e) => {
    isDragging = true;
    prevX = e.clientX;
    prevY = e.clientY;
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - prevX;
    const dy = e.clientY - prevY;
    rotY += dx * 0.5;
    rotX -= dy * 0.5;
    container.style.transform =
      `rotateX(${rotX}deg) rotateY(${rotY + (flipped ? 180 : 0)}deg)`;
    prevX = e.clientX;
    prevY = e.clientY;
  });

  window.addEventListener('mouseup', () => isDragging = false);

  /* Expandable panel toggle */
  const expandToggle = document.getElementById("expandToggle");
  const expandPanel  = document.getElementById("expandPanel");

  expandToggle.addEventListener("click", () => {
    const open = expandPanel.style.display === "block";
    expandPanel.style.display = open ? "none" : "block";
    expandToggle.textContent = open ? "More ▼" : "More ▲";
  });

  /* SHA-256 hashing */
  async function sha256(str) {
    const buf = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest("SHA-256", buf);
    return Array.from(new Uint8Array(hash))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");
  }

  async function applyHash() {
    const active = flipped ? editorBack : editorFront;
    const sel = active.value.substring(active.selectionStart, active.selectionEnd);
    const text = sel || active.value;

    const hashed = await sha256(text);

    if (sel) {
      active.setRangeText(hashed, active.selectionStart, active.selectionEnd, "end");
    } else {
      active.value = hashed;
    }
  }

  /* Hash button hover activation */
  const hashBtn = document.getElementById("hashBtn");
  let hoverTimer = null;
  let flashTimer = null;

  hashBtn.addEventListener("mouseenter", () => {
    flashTimer = setTimeout(() => {
      hashBtn.classList.add("flash");
      setTimeout(() => hashBtn.classList.remove("flash"), 500);
    }, 1500);

    hoverTimer = setTimeout(applyHash, 2000);
  });

  hashBtn.addEventListener("mouseleave", () => {
    clearTimeout(hoverTimer);
    clearTimeout(flashTimer);
    hashBtn.classList.remove("flash");
  });
  /* ----------  Autoload ---------- */
  
  const STORAGE_KEY_FRONT = "diabolical_front";
  const STORAGE_KEY_BACK  = "diabolical_back";
  
  /* Load saved text when page opens */
  window.addEventListener("DOMContentLoaded", () => {
    const savedFront = localStorage.getItem(STORAGE_KEY_FRONT);
    const savedBack  = localStorage.getItem(STORAGE_KEY_BACK);
  
    if (savedFront !== null) editorFront.value = savedFront;
    if (savedBack  !== null) editorBack.value  = savedBack;
  });

</script>

</body>
</html>
