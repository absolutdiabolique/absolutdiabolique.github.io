<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<title>diabolical text</title>
<style>
  html, body { 
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #0b1220;
    color: #e6eef8;
    font-family: 'Times New Roman', serif;
    overflow: hidden;
    perspective: 1000px;
  }

  .ui {
    position: fixed;
    top: 5%;
    left: 5%;
    width: 90%;
    height: 10%;
    background: #173063;
    border: 1px solid black;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 8px 16px;
    box-sizing: border-box;
    font-size: 14px;
    z-index: 5;
  }

  select, button {
    background: #0b1220;
    color: #e6eef8;
    border: 1px solid #000;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
  }

  .ta-container {
    position: fixed;
    width: 90%;
    height: 75%;
    left: 5%;
    top: 20%;
    transform-style: preserve-3d;
    transform-origin: center center;
    cursor: grab;
    transition: transform 0.6s;
  }

  .ta-container:active {
    cursor: grabbing;
  }

  .ta-wrap {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    transform-style: preserve-3d;
  }

  .ta-front, .ta-back {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    backface-visibility: hidden;
    transform-style: preserve-3d;
  }

  .ta-front {
    background: #173063;
    color: #e6eef8;
    border: 1px solid black;
  }

  .ta-back {
    background: #ffffff;
    color: #0b1220;
    border: 1px solid black;
    transform: rotateY(180deg);
  }

  textarea {
    width: 100%;
    height: 100%;
    background: transparent;
    color: inherit;
    border: none;
    resize: none;
    padding: 20px;
    box-sizing: border-box;
    font-size: 16px;
    font-family: inherit;
  }

  .rotator {
    position: absolute;
    top: -45px;
    left: 50%;
    transform: translateX(-50%);
    transform: rotate(0.5turn);
    width: 2px;
    height: 45px;
    display: flex;
    align-items: center;
    flex-direction: column;
    pointer-events: none;
    z-index: 20;
  }

  .rotator-line {
    width: 2px;
    height: 25px;
    background: #66ccff;
  }

  .rotate-handle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #66ccff;
    border: 2px solid #0b1220;
    cursor: grab;
    pointer-events: auto; 
  }

  .rotate-handle:active {
    cursor: grabbing;
  }
</style>
</head>
<body>

  <div class="ui">
    <select id="fontSelect">
      <option value="Times New Roman">Times New Roman</option>
      <option value="Arial">Arial</option>
      <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
      <option value="Georgia">Georgia</option>
      <option value="'Courier New'">Courier New</option>
    </select>

    <button id="decrease">A-</button>
    <button id="increase">A+</button>
    <button id="flip">Flip</button>
    <button id="reset">Reset</button>
  </div>

  <div class="ta-container" id="taContainer">

    <div class="ta-wrap" id="taWrap">
      <div class="ta-front">
        <textarea id="editorFront" placeholder="Front side..."></textarea>
      </div>

      <div class="ta-back">
        <textarea id="editorBack" placeholder="Back side..."></textarea>
      </div>
    </div>

    <div class="rotator" id="rotator">
      <div class="rotator-line"></div>
      <div class="rotate-handle" id="rotateHandle"></div>
    </div>

  </div>

<script>
  const editorFront = document.getElementById('editorFront');
  const editorBack = document.getElementById('editorBack');
  const fontSelect = document.getElementById('fontSelect');
  const inc = document.getElementById('increase');
  const dec = document.getElementById('decrease');
  const flipBtn = document.getElementById('flip');
  const resetBtn = document.getElementById('reset');
  const container = document.getElementById('taContainer');

  let rotX = 0, rotY = 0, flipped = false;

  fontSelect.addEventListener('change', () => {
    editorFront.style.fontFamily = fontSelect.value;
    editorBack.style.fontFamily = fontSelect.value;
  });

  inc.addEventListener('click', () => {
    [editorFront, editorBack].forEach(el => {
      const size = parseInt(window.getComputedStyle(el).fontSize, 10);
      el.style.fontSize = (size + 2) + 'px';
    });
  });

  dec.addEventListener('click', () => {
    [editorFront, editorBack].forEach(el => {
      const size = parseInt(window.getComputedStyle(el).fontSize, 10);
      el.style.fontSize = Math.max(size - 2, 6) + 'px';
    });
  });

  flipBtn.addEventListener('click', () => {
    flipped = !flipped;
    container.style.transform = `rotateX(${rotX}deg) rotateY(${rotY + (flipped ? 180 : 0)}deg)`;
  });

  /* RESET ORIENTATION */
  resetBtn.addEventListener('click', () => {
    rotX = 0;
    rotY = 0;
    flipped = false;

    container.style.transition = "transform 0.5s";
    container.style.transform = `rotateX(0deg) rotateY(0deg) rotate(0deg)`;
    setTimeout(() => container.style.transition = "", 600);
  });

  /* DRAG ROTATION */
  let isDragging = false;
  let prevX = 0;
  let prevY = 0;

  container.addEventListener('mousedown', (e) => {
    if(e.target === document.getElementById('rotateHandle')) return;
    isDragging = true;
    prevX = e.clientX;
    prevY = e.clientY;
  });

  window.addEventListener('mousemove', (e) => {
    if(!isDragging) return;
    const dx = e.clientX - prevX;
    const dy = e.clientY - prevY;
    rotY += dx * 0.5;
    rotX -= dy * 0.5;
    container.style.transform = `rotateX(${rotX}deg) rotateY(${rotY + (flipped ? 180 : 0)}deg)`;
    prevX = e.clientX;
    prevY = e.clientY;
  });

  window.addEventListener('mouseup', () => {
    isDragging = false;
  });

  /* HANDLE ROTATION (Z axis) */
  const handle = document.getElementById('rotateHandle');
  let rotating = false;
  let startAngle = 0;
  let startRotation = 0;

  function getAngle(e) {
    const rect = container.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    return Math.atan2(e.clientY - cy, e.clientX - cx) * (180 / Math.PI);
  }

  handle.addEventListener('mousedown', (e) => {
    rotating = true;
    startAngle = getAngle(e);

    const transform = window.getComputedStyle(container).transform;
    if (transform !== 'none') {
      const vals = transform.split('(')[1].split(')')[0].split(',');
      const a = parseFloat(vals[0]), b = parseFloat(vals[1]);
      startRotation = Math.atan2(b, a) * (180 / Math.PI);
    } else {
      startRotation = 0;
    }

    e.stopPropagation();
    e.preventDefault();
  });

  window.addEventListener('mousemove', (e) => {
    if (!rotating) return;
    const angle = getAngle(e);
    const delta = angle - startAngle;

    container.style.transform =
      `rotateX(${rotX}deg) rotateY(${rotY + (flipped ? 180 : 0)}deg) rotate(${startRotation + delta}deg)`;
  });

  window.addEventListener('mouseup', () => {
    rotating = false;
  });
</script>

</body>
</html>
